<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strav Tournament - Play & Win</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="bg-gray-50 font-sans text-gray-800">

    <!-- Login/Signup Panel -->
    <div id="auth-container" class="max-w-md mx-auto min-h-screen flex items-center justify-center p-6">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl w-full border border-blue-50 text-center">
            <h1 class="text-5xl font-black text-blue-600 mb-2 italic tracking-tighter">STRAV</h1>
            <p id="auth-title" class="text-gray-400 font-bold text-[10px] uppercase tracking-[0.3em] mb-10">Tournament Gaming</p>
            
            <div class="space-y-4">
                <input id="email" type="email" placeholder="Email Address" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-400">
                <input id="password" type="password" placeholder="Password" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-400">
                <button onclick="handleAuth()" id="auth-btn" class="w-full py-4 bg-gradient-to-r from-blue-600 to-teal-400 text-white font-black rounded-2xl shadow-lg">LOGIN</button>
                <button onclick="toggleAuth()" class="text-xs font-bold text-blue-500 mt-4 uppercase">New to Strav? Join Now</button>
            </div>
        </div>
    </div>

    <!-- Main App Panel -->
    <div id="app-container" class="max-w-md mx-auto min-h-screen pb-24 hidden relative bg-gray-50">
        <header class="bg-white/90 backdrop-blur-md p-4 flex justify-between items-center shadow-sm sticky top-0 z-50 border-b">
            <h1 class="font-black text-2xl text-blue-600 italic tracking-tighter">STRAV</h1>
            <div class="flex items-center gap-3">
                <button onclick="shareApp()" class="w-9 h-9 flex items-center justify-center text-gray-400 bg-gray-100 rounded-full"><i class="fas fa-share-alt"></i></button>
                <div onclick="navigate('wallet')" class="bg-blue-50 px-4 py-1.5 rounded-full border border-blue-100 font-black text-blue-600 text-sm shadow-sm">
                    â‚¹<span id="user-balance">0</span>
                </div>
            </div>
        </header>

        <main id="main-content" class="p-4 space-y-4"></main>

        <!-- Customer Support Button -->
        <a href="https://t.me/strav_support" target="_blank" class="fixed bottom-24 right-6 w-14 h-14 bg-[#0088cc] text-white rounded-full shadow-2xl flex items-center justify-center text-2xl z-40">
            <i class="fab fa-telegram-plane"></i>
        </a>

        <!-- Bottom Nav -->
        <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t flex justify-around p-4 shadow-2xl z-50 rounded-t-[2rem]">
            <button onclick="navigate('home')" class="nav-btn text-blue-600 flex flex-col items-center"><i class="fas fa-gamepad text-xl"></i><span class="text-[9px] font-black mt-1 uppercase">Matches</span></button>
            <button onclick="navigate('mycontests')" class="nav-btn text-gray-400 flex flex-col items-center"><i class="fas fa-trophy text-xl"></i><span class="text-[9px] font-black mt-1 uppercase">Joined</span></button>
            <button onclick="navigate('wallet')" class="nav-btn text-gray-400 flex flex-col items-center"><i class="fas fa-wallet text-xl"></i><span class="text-[9px] font-black mt-1 uppercase">Wallet</span></button>
            <button onclick="navigate('profile')" class="nav-btn text-gray-400 flex flex-col items-center"><i class="fas fa-user-circle text-xl"></i><span class="text-[9px] font-black mt-1 uppercase">Strav ID</span></button>
        </nav>
    </div>

    <script>
        // --- YOUR CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBmFnbCqdXp4FbKtlMa9a1TjZTIUlzB6uE",
            authDomain: "strav-tournament-app.firebaseapp.com",
            databaseURL: "https://strav-tournament-app-default-rtdb.firebaseio.com",
            projectId: "strav-tournament-app",
            storageBucket: "strav-tournament-app.firebasestorage.app",
            messagingSenderId: "873709853744",
            appId: "1:873709853744:web:0d03269c05d480747e61f5"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let isLogin = true;

        // --- ADSTERRA AUTO-AD ---
        function triggerAd() {
            const ad = document.createElement('script');
            ad.src = "https://pl28731178.effectivegatecpm.com/64/6f/11/646f11b8e09d654e15dab856d3770e4c.js";
            document.body.appendChild(ad);
        }

        // --- SHARE STRAV ---
        function shareApp() {
            triggerAd();
            const text = "ðŸ† Join STRAV Tournament! Play games & Win Real Cash Everyday. Join now: " + window.location.href;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
        }

        function toggleAuth() {
            isLogin = !isLogin;
            document.getElementById('auth-btn').innerText = isLogin ? 'LOGIN' : 'SIGN UP';
        }

        async function handleAuth() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                if(isLogin) await auth.signInWithEmailAndPassword(email, pass);
                else {
                    const res = await auth.createUserWithEmailAndPassword(email, pass);
                    await db.ref('users/' + res.user.uid).set({ email, balance: 0, joinedAt: Date.now() });
                }
                triggerAd();
            } catch(e) { alert(e.message); }
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                db.ref('users/' + user.uid).on('value', s => { if(s.val()) document.getElementById('user-balance').innerText = s.val().balance || 0; });
                navigate('home');
                triggerAd();
            } else {
                document.getElementById('auth-container').classList.remove('hidden');
                document.getElementById('app-container').classList.add('hidden');
            }
        });

        function navigate(page) {
            triggerAd();
            const main = document.getElementById('main-content');
            if(page === 'home') renderHome();
            else if(page === 'mycontests') renderMyContests();
            else if(page === 'wallet') renderWallet();
            else if(page === 'profile') renderProfile();
        }

        function renderHome() {
            const main = document.getElementById('main-content');
            main.innerHTML = `<h2 class="font-black text-xl mb-4 text-gray-700">Live Tournaments</h2><div id="t-list" class="space-y-4"></div>`;
            db.ref('tournaments').on('value', snap => {
                let html = '';
                snap.forEach(t => {
                    const v = t.val();
                    if(v.status === 'open') {
                        const slotsLeft = v.totalSlots - (v.joinedCount || 0);
                        html += `
                        <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-gray-100">
                            <div class="flex justify-between items-start">
                                <div><span class="text-[9px] font-black bg-blue-100 text-blue-600 px-2 py-0.5 rounded uppercase tracking-widest">${v.game}</span><h3 class="font-black text-lg mt-1">${v.title}</h3></div>
                                <div class="text-right text-blue-600 font-black text-xl">â‚¹${v.fee}</div>
                            </div>
                            <div class="mt-4 flex justify-between font-black text-[10px] uppercase text-gray-400 border-t pt-4 border-dashed">
                                <span>Prize Pool: <span class="text-green-500">â‚¹${v.prize}</span></span>
                                <span class="text-orange-500">${slotsLeft} Slots Left</span>
                            </div>
                            <button onclick="joinMatch('${t.key}', ${v.fee})" class="w-full mt-4 py-3.5 bg-blue-600 text-white font-black rounded-2xl shadow-lg">JOIN NOW</button>
                        </div>`;
                    }
                });
                document.getElementById('t-list').innerHTML = html || 'No Matches Available';
            });
        }

        async function joinMatch(tid, fee) {
            const userSnap = await db.ref('users/' + auth.currentUser.uid).get();
            const bal = userSnap.val().balance || 0;
            if(bal < fee) return alert("Low Balance!");
            if(confirm("Join Strav Tournament?")) {
                await db.ref('users/' + auth.currentUser.uid).update({ balance: bal - fee });
                const tSnap = await db.ref('tournaments/' + tid).get();
                await db.ref('tournaments/' + tid).update({ joinedCount: (tSnap.val().joinedCount || 0) + 1 });
                await db.ref(`tournaments/${tid}/players/${auth.currentUser.uid}`).set({ email: auth.currentUser.email });
                alert("Joined!");
                triggerAd();
                navigate('mycontests');
            }
        }

        function renderMyContests() {
            const main = document.getElementById('main-content');
            main.innerHTML = `<h2 class="font-black text-xl mb-4">My Joined Matches</h2><div id="my-list" class="space-y-4"></div>`;
            db.ref('tournaments').on('value', snap => {
                let html = '';
                snap.forEach(t => {
                    const v = t.val();
                    if(v.players && v.players[auth.currentUser.uid]) {
                        html += `<div class="bg-white p-5 rounded-3xl border-l-[10px] border-blue-600 shadow-sm">
                            <h3 class="font-black text-lg">${v.title}</h3>
                            <div class="mt-4 p-4 bg-blue-50 rounded-2xl border border-dashed border-blue-200">
                                <p class="text-[10px] font-black text-blue-600 uppercase mb-2">Room Details</p>
                                <div class="flex justify-between font-bold text-xs">
                                    <span>ID: ${v.roomID || 'TBA'}</span>
                                    <span>Pass: ${v.roomPass || 'TBA'}</span>
                                </div>
                            </div>
                        </div>`;
                    }
                });
                document.getElementById('my-list').innerHTML = html || 'Join a match first!';
            });
        }

        function renderWallet() {
            const main = document.getElementById('main-content');
            main.innerHTML = `
                <div class="bg-gradient-to-r from-blue-600 to-teal-400 p-8 rounded-[2.5rem] text-white text-center shadow-xl">
                    <p class="text-[10px] font-black uppercase opacity-70 mb-2 tracking-widest">Available Balance</p>
                    <h2 class="text-5xl font-black italic tracking-tighter">â‚¹${document.getElementById('user-balance').innerText}</h2>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <button onclick="addCash()" class="bg-white p-6 rounded-3xl border border-green-100 flex flex-col items-center gap-2"><i class="fas fa-plus text-green-500"></i><span class="font-black text-xs">ADD CASH</span></button>
                    <button onclick="withdraw()" class="bg-white p-6 rounded-3xl border border-red-100 flex flex-col items-center gap-2"><i class="fas fa-university text-red-500"></i><span class="font-black text-xs">WITHDRAW</span></button>
                </div>
            `;
        }

        async function addCash() {
            const amt = prompt("Amount â‚¹:");
            const ref = prompt("Transaction ID:");
            if(amt && ref) {
                await db.ref('transactions').push({ uid: auth.currentUser.uid, email: auth.currentUser.email, amount: parseInt(amt), method: ref, type: 'add', status: 'pending', timestamp: Date.now() });
                alert("Request Sent!");
                triggerAd();
            }
        }

        async function withdraw() {
            const amt = prompt("Amount â‚¹:");
            const upi = prompt("UPI ID:");
            if(amt && upi) {
                await db.ref('transactions').push({ uid: auth.currentUser.uid, email: auth.currentUser.email, amount: parseInt(amt), method: upi, type: 'withdraw', status: 'pending', timestamp: Date.now() });
                alert("Request Sent!");
                triggerAd();
            }
        }

        function renderProfile() {
            const main = document.getElementById('main-content');
            main.innerHTML = `<div class="bg-white p-8 rounded-[2.5rem] shadow-sm border text-center">
                <div class="w-20 h-20 bg-blue-100 rounded-full mx-auto mb-4 flex items-center justify-center text-blue-600 text-3xl font-black border-4 border-white shadow-md">${auth.currentUser.email[0].toUpperCase()}</div>
                <h2 class="font-black text-lg text-gray-800">${auth.currentUser.email}</h2>
                <div class="mt-10 space-y-4">
                    <a href="https://t.me/strav_support" target="_blank" class="block p-4 bg-gray-50 rounded-2xl border font-black text-sm text-[#0088cc]">Telegram Support</a>
                    <button onclick="shareApp()" class="w-full p-4 bg-orange-50 rounded-2xl border font-black text-sm text-orange-600">Invite Friends</button>
                    <button onclick="auth.signOut()" class="w-full text-red-500 font-black text-sm pt-4 italic">Sign Out</button>
                </div>
            </div>`;
        }
    </script>
</body>
</html>
